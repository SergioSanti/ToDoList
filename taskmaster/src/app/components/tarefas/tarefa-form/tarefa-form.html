<div class="tarefa-form-container">
  <!-- Header -->
  <div class="page-header">
    <div class="header-content">
      <h1 class="page-title">
        {{ isEditMode() ? 'Editar Tarefa' : 'Nova Tarefa' }}
      </h1>
      <p class="page-subtitle">
        {{ isEditMode() ? 'Atualize as informações da tarefa' : 'Preencha os dados para criar uma nova tarefa' }}
      </p>
    </div>
    <button 
      type="button"
      (click)="cancel()"
      class="btn btn-secondary"
    >
      Cancelar
    </button>
  </div>

  <!-- Form -->
  <div class="form-container">
    <form [formGroup]="tarefaForm" (ngSubmit)="onSubmit()" class="tarefa-form">
      <!-- Título -->
      <div class="form-group">
        <label for="titulo" class="form-label">Título *</label>
        <input
          type="text"
          id="titulo"
          formControlName="titulo"
          class="form-control"
          [class.is-invalid]="tarefaForm.get('titulo')?.invalid && tarefaForm.get('titulo')?.touched"
          placeholder="Digite o título da tarefa"
        >
        @if (getFieldError('titulo')) {
          <div class="invalid-feedback">
            {{ getFieldError('titulo') }}
          </div>
        }
      </div>

      <!-- Descrição -->
      <div class="form-group">
        <label for="descricao" class="form-label">Descrição *</label>
        <textarea
          id="descricao"
          formControlName="descricao"
          class="form-control"
          [class.is-invalid]="tarefaForm.get('descricao')?.invalid && tarefaForm.get('descricao')?.touched"
          placeholder="Descreva os detalhes da tarefa"
          rows="4"
        ></textarea>
        @if (getFieldError('descricao')) {
          <div class="invalid-feedback">
            {{ getFieldError('descricao') }}
          </div>
        }
      </div>

      <!-- Prioridade -->
      <div class="form-group">
        <label for="prioridade" class="form-label">Prioridade *</label>
        <select
          id="prioridade"
          formControlName="prioridade"
          class="form-control"
          [class.is-invalid]="tarefaForm.get('prioridade')?.invalid && tarefaForm.get('prioridade')?.touched"
        >
          @for (option of getPrioridadeOptions(); track option.value) {
            <option [value]="option.value">
              {{ option.label }}
            </option>
          }
        </select>
        @if (getFieldError('prioridade')) {
          <div class="invalid-feedback">
            {{ getFieldError('prioridade') }}
          </div>
        }
      </div>

      <!-- Categoria -->
      <div class="form-group">
        <label for="categoriaId" class="form-label">Categoria *</label>
        <select
          id="categoriaId"
          formControlName="categoriaId"
          class="form-control"
          [class.is-invalid]="tarefaForm.get('categoriaId')?.invalid && tarefaForm.get('categoriaId')?.touched"
        >
          <option value="">Selecione uma categoria</option>
          @for (categoria of categorias(); track categoria.id) {
            <option [value]="categoria.id">
              {{ categoria.nome }}
            </option>
          }
        </select>
        @if (getFieldError('categoriaId')) {
          <div class="invalid-feedback">
            {{ getFieldError('categoriaId') }}
          </div>
        }
        @if (categorias().length === 0) {
          <div class="form-help">
            <p>Nenhuma categoria encontrada. <a routerLink="/categorias/nova">Criar nova categoria</a></p>
          </div>
        }
      </div>

      <!-- Status (apenas no modo de edição) -->
      @if (isEditMode()) {
        <div class="form-group">
        <label for="status" class="form-label">Status</label>
        <select
          id="status"
          formControlName="status"
          class="form-control"
        >
          @for (option of getStatusOptions(); track option.value) {
            <option [value]="option.value">
              {{ option.label }}
            </option>
          }
        </select>
        </div>
      }

      <!-- Form Actions -->
      <div class="form-actions">
        <button
          type="submit"
          class="btn btn-primary"
          [disabled]="isLoading() || tarefaForm.invalid"
        >
          @if (isLoading()) {
            <span class="spinner-border spinner-border-sm me-2"></span>
          }
          {{ isLoading() ? 'Salvando...' : (isEditMode() ? 'Atualizar' : 'Criar') }}
        </button>
        
        <button
          type="button"
          (click)="cancel()"
          class="btn btn-secondary"
          [disabled]="isLoading()"
        >
          Cancelar
        </button>
      </div>
    </form>
  </div>
</div>